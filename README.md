mineral-deposit-segmentation-pipeline
=====================================

A pipeline for segmenting mineral deposits on clinical magnetic resonance imaging (MRI) volumes of the brain [0,1,2,3,4].

The pipeline was originally developed at the Brain Imaging Research Centre [5] as part of a PhD project supported by SINAPSE/Spirit [6] on Red Hat Enterprise Linux 5 [7] and Matlab 2011b [8].

Requirements for the main processing pipeline:
- Tools for writing and reading NIfTI and ANALYZE image in MATLAB [15]
- LIBRA: a Matlab library for robust analysis [16]

Optional requirements to enable parallel processing of the imaging data
- Parallel Matlab Toolbox [17]

Optional requirements for the preprocessing pipeline:
- Recent Linux distribution (e.g. Neurodebian [9]) with Bash [10], Perl [11], make and rsync. 
- FMRIB FSL library [12]
- N4 intensity inhomogeneity correction tool [13] e.g. from Slicer3 [14]

Unit test of the segmentation method:
Structural T1- and T2*-weighted volumes of an MRI phantom containing different kinds of mineral deposits can be found in ${GITROOTDIR}/libBRIC/mineral-deposit-segmentation/lesionphantom, where the script will place its output as well. The following steps are detailed instructions for Linux. However, the software can also be tested under MS Windows by downloading the zip archive of the software (see links on the top left), and viewing the results with a Nifti viewer for MS Windows, such as Mango, and ghostview for MS Windows.

Steps for running the main processing pipeline on Linux:
- cd /to/some/new/directory
- download and extract NIFTI[15] and LIBRA[16] toolboxes for MATLAB
- git clone git@github.com:aglatz/mineral-deposit-segmentation-pipeline.git
- cd libBRIC/mineral-deposit-segmentation/
- run the following matlab commands:
* addpath('../misc-matlab/'); % include local library
* addpath('NIFTI/'); % include NIFTI toolbox functions
* addpath('LIBRA/'); % include LIBRA toolbox functions
* RoiLabelTable={1,2,3,4,5,6,7,8,9,10}; % define ROI labes of interest
* [Ret] = segment_us_single('lesionphantom', RoiLabelTable, 'class', [1 0], 1, 1, 0, 0.1, 0); % Run segmentation on the lesion phantom volumes

Steps for viewing the generated output on Linux:
- cd lesionphantom
- fslview -m single GRE_restore.nii.gz T1W_restore.nii.gz NonTis_mask.nii.gz NormTis_mask.nii.gz T2swHypo_mask.nii.gz # to view the masks
- ../misc-scripts/ps2pdfAll.sh # converts the *.ps files into *.pdf files
- acroread class.pdf # to look at the stats

The last three volumes of the last command were generated by the software. The volumes are:
- GRE_restore is the biasfield corrected T2*-weighted volume
- T1W_restore is the biasfield corrected T1-weighted volume
- NonTis_mask is the mask that selects voxels that were classified as non normal-appearing tissue
- NormTis_mask is the mask that selects voxels that were classified as normal-appearing tissue
- T2swHypo_mask.nii.gz is the mask that selects the lesions of the lesion phantom.

Once you did that I would recommend that you try out the software on co-registered T1- and T2*-weighted volumes of a single subject of your study. You should used the script 'segment_us_mp.m' for that. It uses the pMatlab [17] library. You also could use pSegment_us.m directly after some modifications.

References:
[0] https://dx.doi.org/10.1016/j.neuroimage.2014.10.001
[1] http://www.biomedical-image-analysis.co.uk/images/stories/glatz-posters1-32.pdf
[2] http://www.neuroinformatics2012.org/abstracts/intuitive-and-efficient-deployment-of-neuroimaging-pipelines-in-clinical-research-with-bricpipe
[3] https://dx.doi.org/10.1594/ecr2013/C-2293
[4] https://www.ucl.ac.uk/cabi/PDF/PG-BCISMRM_2013_Abstract_booklet_final.pdf
[5] http://www.bric.ed.ac.uk
[6] http://www.sinapse.ac.uk
[7] http://www.redhat.com/products/enterprise-linux
[8] http://www.mathworks.com
[9] http://neuro.debian.net/
[10] http://www.gnu.org/software/bash
[11] http://www.perl.org
[12] http://fsl.fmrib.ox.ac.uk/fsl
[13] http://www.insight-journal.org/browse/publication/640
[14] http://www.slicer.org/
[15] http://www.mathworks.co.uk/matlabcentral/fileexchange/8797-tools-for-nifti-and-analyze-image
[16] http://wis.kuleuven.be/stat/robust/LIBRA/LIBRA-home
[17] http://www.ll.mit.edu/mission/isr/pmatlab/pmatlab.html

