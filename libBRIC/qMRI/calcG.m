close all; clear all

cd('/home/s1063233/23680/7');
S = double(load_series('S_phu_f0', [35:39]));
S = S(:, :, :, 1);

S_out = nan(256, 256);
%z = [-3; -1; 1; 3; 5]; % 23652
%z = [-16.94786835; -14.94786835; -12.94786835; -10.94786835; -8.947868347]; % 23658
%z = [-34.06939697; -32.06939697; -30.06939697; -28.06939697; -26.06939697]; % 23634
z = [10.3198; 12.3198; 14.3198; 16.3198; 18.3198];
for i1=1:256
    for i2=1:256
        I = squeeze(S(i1, i2, :));
        M = ~isnan(I);
        if sum(M) >= 3
        P = polyfit(z(M), I(M), 1);
        S_out(i1, i2) = P(1); % Hz/mm
        end
    end
end

save_series('S_phu_f0', 'S_phu_G', single(S_out), []);